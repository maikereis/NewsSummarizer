from abc import ABC, abstractmethod
from tempfile import mkdtemp

import chromedriver_autoinstaller
import edgedriver_autoinstaller
from selenium import webdriver

class SingletonMeta(type):
    _instances = {}

    def __call__(cls, *args, **kwargs):
        if cls not in cls._instances:
            instance = super().__call__(*args, **kwargs)
            cls._instances[cls] = instance
        return cls._instances[cls]

class WebDriverCreator(ABC, metaclass=SingletonMeta):
    @abstractmethod
    def create_webdriver(self):
        pass

class ChromeWebDriverCreator(WebDriverCreator):
    def create_webdriver(self):
        chromedriver_autoinstaller.install()
        options = webdriver.ChromeOptions()
        self._set_common_options(options)
        return webdriver.Chrome(options=options)

    def _set_common_options(self, options):
        options.add_argument("--no-sandbox")
        options.add_argument("--headless=new")
        options.add_argument("--disable-dev-shm-usage")
        options.add_argument("--log-level=3")
        options.add_argument("--disable-popup-blocking")
        options.add_argument("--disable-notifications")
        options.add_argument("--disable-extensions")
        options.add_argument("--disable-background-networking")
        options.add_argument("--ignore-certificate-errors")
        options.add_argument(f"--user-data-dir={mkdtemp()}")
        options.add_argument(f"--data-path={mkdtemp()}")
        options.add_argument(f"--disk-cache-dir={mkdtemp()}")
        options.add_argument("--remote-debugging-port=9226")

class EdgeWebDriverCreator(WebDriverCreator):
    def create_webdriver(self):
        edgedriver_autoinstaller.install()
        options = webdriver.EdgeOptions()
        self._set_common_options(options)
        return webdriver.Edge(options=options)

    def _set_common_options(self, options):
        options.add_argument("--no-sandbox")
        options.add_argument("--headless=new")
        options.add_argument("--disable-dev-shm-usage")
        options.add_argument("--log-level=3")
        options.add_argument("--disable-popup-blocking")
        options.add_argument("--disable-notifications")
        options.add_argument("--disable-extensions")
        options.add_argument("--disable-background-networking")
        options.add_argument("--ignore-certificate-errors")
        options.add_argument(f"--user-data-dir={mkdtemp()}")
        options.add_argument(f"--data-path={mkdtemp()}")
        options.add_argument(f"--disk-cache-dir={mkdtemp()}")
        options.add_argument("--remote-debugging-port=9226")

# Example usage
chrome_creator = ChromeWebDriverCreator()
chrome_driver = chrome_creator.create_webdriver()

edge_creator = EdgeWebDriverCreator()
edge_driver = edge_creator.create_webdriver()

# Use the drivers as needed
chrome_driver.get("https://g1.globo.com/")
print(chrome_driver.title)
chrome_driver.quit()

edge_driver.get("https://g1.globo.com/")
print(edge_driver.title)
edge_driver.quit()
